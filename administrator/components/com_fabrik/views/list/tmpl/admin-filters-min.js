/*! Fabrik */

define(["jquery"],function(a){return new Class({Implements:[Options],options:{j3:!1},initialize:function(a,b,c){this.el=document.id(a),this.fields=b,this.setOptions(c),this.filters=[],this.counter=0},addHeadings:function(){new Element("thead").adopt(new Element("tr",{id:"filterTh",class:"title"}).adopt(new Element("th").set("text",Joomla.JText._("COM_FABRIK_JOIN")),new Element("th").set("text",Joomla.JText._("COM_FABRIK_FIELD")),new Element("th").set("text",Joomla.JText._("COM_FABRIK_CONDITION")),new Element("th").set("text",Joomla.JText._("COM_FABRIK_VALUE")),new Element("th").set("text",Joomla.JText._("COM_FABRIK_TYPE")),new Element("th").set("text",Joomla.JText._("COM_FABRIK_APPLY_FILTER_TO")),new Element("th").set("text",Joomla.JText._("COM_FABRIK_GROUPED")),new Element("th").set("text",Joomla.JText._("COM_FABRIK_DELETE")))).inject(document.id("filterContainer"),"before")},deleteFilterOption:function(a){this.counter--;var b,c;if(a.stop(),this.options.j3){a.target.id.replace("filterContainer-del-","").toInt();c=a.target.getParent("tr"),b=a.target.getParent("table")}else c=a.target.getParent("tr"),b=a.target.getParent("table");0===this.counter&&b.hide(),this.options.j3?(c.getElements("input, select, textarea").dispose(),c.hide()):c.dispose()},_makeSel:function(a,b,c,d,e){var f=[];return e=!0===e,e&&f.push(new Element("option",{value:""}).set("text",Joomla.JText._("COM_FABRIK_PLEASE_SELECT"))),c.each(function(a){a.value===d?f.push(new Element("option",{value:a.value,selected:"selected"}).set("text",a.label)):f.push(new Element("option",{value:a.value}).set("text",a.label))}),new Element("select",{class:a,name:b}).adopt(f)},addFilterOption:function(a,b,c,d,e,f,g){var h,i,j,k,l;this.counter<=0&&(this.el.getParent("table").getElement("thead")||this.addHeadings()),a=a||"",b=b||"",c=c||"",d=d||"",e=e||"",g=g||"";var m=this.options.filterCondDd,n=new Element("tr");if(0===this.counter?j=new Element("span").set("text","WHERE").adopt(new Element("input",{type:"hidden",id:"paramsfilter-join",class:"inputbox",name:"jform[params][filter-join][]",value:a})):("AND"===a?(h=new Element("option",{value:"AND",selected:"selected"}).set("text","AND"),i=new Element("option",{value:"OR"}).set("text","OR")):(h=new Element("option",{value:"AND"}).set("text","AND"),i=new Element("option",{value:"OR",selected:"selected"}).set("text","OR")),j=new Element("select",{id:"paramsfilter-join",class:"inputbox input-small",name:"jform[params][filter-join][]"}).adopt([h,i])),this.counter<=0){var o=new Element("td");o.appendChild(new Element("input",{type:"hidden",name:"jform[params][filter-grouped]["+this.counter+"]",value:"0"})),o.appendChild(new Element("span").set("text","n/a"))}else{var p="jform_params_filter-grouped_"+this.counter,q="jform[params][filter-grouped]["+this.counter+"]",r=new Element("fieldset",{class:"btn-group radio",id:p}),s={id:p+"_0",type:"radio",name:q,value:"0"};s.checked="1"!==g?"checked":"",r.appendChild(new Element("input",s)),s={for:p+"_0",class:"btn"+("1"!==g?" active btn-danger":"")},r.appendChild(new Element("label",s).set("text",Joomla.JText._("JNO"))),s={id:p+"_1",type:"radio",name:q,value:"1"},s.checked="1"===g?"checked":"",r.appendChild(new Element("input",s)),s={for:p+"_1",class:"btn"+("1"===g?" active btn-success":"")},r.appendChild(new Element("label",s).set("text",Joomla.JText._("JYES")))}var t=new Element("td");t.appendChild(j);var u=new Element("td");u.innerHTML=this.fields;var v=new Element("td");v.innerHTML=m;var w=new Element("td"),x=new Element("td");x.innerHTML=this.options.filterAccess;var y=new Element("td"),z=new Element("textarea",{name:"jform[params][filter-value][]",cols:17,rows:2,style:"width:150px;"}).set("text",d);w.appendChild(z),w.appendChild(new Element("br"));var A=[{value:0,label:Joomla.JText._("COM_FABRIK_TEXT")},{value:1,label:Joomla.JText._("COM_FABRIK_EVAL")},{value:2,label:Joomla.JText._("COM_FABRIK_QUERY")},{value:3,label:Joomla.JText._("COM_FABRIK_NO_QUOTES")}],B=new Element("td").adopt(this._makeSel("inputbox elementtype input-small","jform[params][filter-eval][]",A,f,!1)),C=this.el.id+"-del-"+this.counter,D=this.options.j3?"":Joomla.JText._("COM_FABRIK_DELETE"),E=this.options.j3?"btn btn-danger":"removeButton",F='<button id="'+C+'" class="'+E+'"><i class="icon-minus" style="margin:0"></i> '+D+"</button>";if(y.set("html",F),n.appendChild(t),n.appendChild(u),n.appendChild(v),n.appendChild(w),n.appendChild(B),n.appendChild(x),n.appendChild(new Element("td").adopt(r)),n.appendChild(y),this.el.appendChild(n),this.el.getParent("table").show(),document.id(C).addEvent("click",function(a){this.deleteFilterOption(a)}.bind(this)),document.id(this.el.id+"-del-"+this.counter).click=function(a){this.deleteFilterOption(a)}.bind(this),""!==a&&(l=Array.from(t.getElementsByTagName("SELECT")),l.length>=1))for(k=0;k<l[0].length;k++)l[0][k].value===a&&(l[0].options.selectedIndex=k);if(""!==b&&(l=Array.from(u.getElementsByTagName("SELECT")),l.length>=1))for(k=0;k<l[0].length;k++)l[0][k].value===b&&(l[0].options.selectedIndex=k);if(""!==c&&(l=Array.from(v.getElementsByTagName("SELECT")),l.length>=1))for(k=0;k<l[0].length;k++)l[0][k].value===c&&(l[0].options.selectedIndex=k);if(""!==e&&(l=Array.from(x.getElementsByTagName("SELECT")),l.length>=1))for(k=0;k<l[0].length;k++)l[0][k].value===e&&(l[0].options.selectedIndex=k);this.counter++}})});