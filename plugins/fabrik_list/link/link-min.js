/*! Fabrik */

define(["jquery","fab/list-plugin"],function(a,b){return new Class({Extends:b,options:{link:"",fabrikLink:!1,windowTitle:""},initialize:function(a){this.parent(a)},buttonAction:function(){var b=this.list.getForm().getElements("input[name^=ids]").filter(function(a){return a.checked}),c=b.map(function(a){return a.get("value")}),d={};if(b.each(function(a){var b=a.get("value");d[b]=this.list.getRow(b)}.bind(this)),""!==this.options.link){a.each(Fabrik.Windows,function(a,b){a.test(/^custom\./)&&b.close()});var e=this.options.link;if(a.each(d[c[0]],function(a,b){"__pk_val"===a&&(a="rowid");var c=new RegExp("{"+a+"}","g");e=e.replace(c,b)}),this.options.fabrikLink&&this.list.options.ajax_links){e+=e.contains("?")?"&":"?",e+="tmpl=component&ajax=1",e+="&format=partial";var f={id:"custom."+this.list.id,title:this.options.windowTitle,loadMethod:"xhr",contentURL:e,width:this.list.options.popup_width,height:this.list.options.popup_height};null!==this.list.options.popup_offset_x&&(f.offset_x=this.list.options.popup_offset_x),null!==this.list.options.popup_offset_y&&(f.offset_y=this.options.popup_offset_y),Fabrik.getWindow(f)}else window.location=e}}})});