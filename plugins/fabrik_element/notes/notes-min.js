/*! Fabrik */

define(["jquery","fab/element"],function(a,b){return window.FbNotes=new Class({options:{rowid:0,primaryKey:0,id:0},Extends:b,initialize:function(a,b){this.setPlugin("notes"),this.parent(a,b),this.setUp()},setUp:function(){if(this.options.primaryKey>0){this.element.getElement(".button").addEvent("click",function(a){this.submit(a)}.bind(this)),this.field=this.element.getElement(".fabrikinput");this.element.getElement("div").makeResizable({modifiers:{x:!1,y:"height"},handle:this.element.getElement(".noteHandle")}),this.element.getElement(".noteHandle").setStyle("cursor","all-scroll")}},submit:function(a){a.stop();var b=this.field.get("value");if(""!==b){Fabrik.loader.start(this.element);var c={option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",plugin:"notes",method:"ajax_addNote",element_id:this.options.id,v:b,rowid:this.options.rowid,joinPkVal:this.options.joinPkVal,primaryKey:this.options.primaryKey,formid:this.form.id};this.myAjax=new Request.JSON({url:"",data:c,onSuccess:function(a){if(Fabrik.loader.stop(this.element),this.options.j3){var b=this.element.getElement("div"),c=new Element("div",{class:"row-fluid"});new Element("div",{class:"span12"}).set("html",a.label).inject(c).inject(b)}else{var d=this.element.getElement("ul"),e="oddRow"+d.getElements("li").length%2;new Element("li",{class:e}).set("html",a.label).inject(d)}this.field.value=""}.bind(this),onError:function(a){Fabrik.loader.stop(this.element),window.alert(a)},onFailure:function(a){Fabrik.loader.stop(this.element),window.alert("ajax failed")},onCancel:function(){Fabrik.loader.stop(this.element)}}).send()}},cloned:function(a){Fabrik.fireEvent("fabrik.notes.update",this),this.parent(a)}}),window.FbNotes});