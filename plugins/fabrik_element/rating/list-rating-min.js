/*! Fabrik */

define(["jquery"],function(a){return new Class({options:{userid:0,mode:"",formid:0},Implements:[Events,Options],initialize:function(a,b){b.element=a,this.setOptions(b),!1!==this.options.canRate&&"creator-rating"!==this.options.mode&&(this.col=$$("."+a),this.origRating={},this.col.each(function(a){var b=a.getElements(".starRating");b.each(function(c){c.addEvent("mouseover",function(d){this.origRating[a.id]=c.getParent(".fabrikRating").getElement(".ratingScore").innerHTML.toInt(),b.each(function(a){this._getRating(c)>=this._getRating(a)?a.removeClass(this.options.starIconEmpty).addClass(this.options.starIcon):a.addClass(this.options.starIconEmpty).removeClass(this.options.starIcon)}.bind(this))}.bind(this)),c.addEvent("mouseout",function(c){b.each(function(b){this.origRating[a.id]>=this._getRating(b)?b.removeClass(this.options.starIconEmpty).addClass(this.options.starIcon):b.addClass(this.options.starIconEmpty).removeClass(this.options.starIcon)}.bind(this))}.bind(this))}.bind(this)),b.each(function(a){a.addEvent("click",function(b){this.doAjax(b,a)}.bind(this))}.bind(this))}.bind(this)))},_getRating:function(a){return a.get("data-rating").toInt()},doAjax:function(a,b){a.stop(),this.rating=this._getRating(b);var c=b.getParent(".fabrikRating");Fabrik.loader.start(c);var d=document.id(b).getParent(".fabrik_row"),e=d.id.replace("list_"+this.options.listRef+"_row_",""),f={option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",plugin:"rating",g:"element",method:"ajax_rate",formid:this.options.formid,element_id:this.options.elid,row_id:e,elementname:this.options.elid,userid:this.options.userid,rating:this.rating,mode:this.options.mode};new Request({url:"",data:f,onComplete:function(a){this.rating=Math.round(parseFloat(a)),Fabrik.loader.stop(c),b.getParent(".fabrikRating").getElement(".ratingScore").set("html",a),b.getParent(".fabrikRating").getElements(".starRating").each(function(a){this.rating>=this._getRating(a)?a.removeClass(this.options.starIconEmpty).addClass(this.options.starIcon):a.addClass(this.options.starIconEmpty).removeClass(this.options.starIcon)}.bind(this))}.bind(this)}).send()}})});