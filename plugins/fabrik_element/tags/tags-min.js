/*! Fabrik */

define(["jquery","fab/fabrik","fab/chosen-loader","fab/element"],function(a,b,c,d){return window.FbTags=new Class({options:{rowid:"",id:0,listid:""},Extends:d,initialize:function(a,b){this.parent(a,b),this.options.editable&&this.setUp()},setUp:function(){b.buildChosen("#"+this.options.element,{disable_search_threshold:10,allow_single_deselect:!0}),this.sel=b.buildAjaxChosen("#"+this.options.element,{type:"GET",url:b.liveSite+"index.php?option=com_fabrik&view=list&listid="+this.options.listid+"&format=tags&elID="+this.options.id,dataType:"json",jsonTermKey:"like",afterTypeDelay:"500",minTermLength:"3"},function(b){var c=[];return a.each(b,function(a,b){c.push({value:b.value,text:b.text})}),c});var c=this.sel;a(c).on("change",function(){var b=a(c).find("option");a(c.data().chosen.results_data).each(function(){a(b[this.options_index]).attr("selected",this.selected)})}),this.watchNew()},watchNew:function(){var b,c=a(this.getContainer()),d=this.options.element;c.find(".search-field input").keydown(function(e){if(this.value.length>=3&&(13===e.which||188===e.which)){var f=c.find("li.active-result.highlighted").first();if(13===e.which&&""!==f.text()){var g="#fabrik#"+f.text();c.find("option").filter(function(){return a(this).val()===g}).remove(),b=c.find("option").filter(function(){return a(this).html()===f.text()}),b.attr("selected","selected")}else{var h=this.value;if(b=c.find("option").filter(function(){return a(this).html()===h}),""!==b.text())b.attr("selected","selected");else{var i=a("<option>");i.text(this.value).val("#fabrik#"+this.value),i.attr("selected","selected"),c.find("select").append(i)}}this.value="",a("#"+d).trigger("liszt:updated"),e.preventDefault()}})},cloned:function(a){b.fireEvent("fabrik.tags.update",this),this.parent(a),this.setUp()}}),window.FbTags});