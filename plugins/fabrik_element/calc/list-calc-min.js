/*! Fabrik */

define(["jquery","fab/encoder"],function(a,b){return new Class({options:{},Implements:[Events,Options],initialize:function(a,b){b.element=a,this.setOptions(b),this.col=$$("."+a),this.list=Fabrik.blocks[this.options.listRef],this.options.doListUpdate&&Fabrik.addEvent("fabrik.list.updaterows",function(){this.update()}.bind(this))},update:function(){var a={option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",plugin:"calc",g:"element",listid:this.options.listid,formid:this.options.formid,method:"ajax_listUpdate",element_id:this.options.elid,rows:this.list.getRowIds(),elementname:this.options.elid};new Request.JSON({url:"",data:a,onError:function(a,b){fconsole("Fabrik:list-calc:update error:"+b,a)},onFailure:function(a){fconsole(a)},onSuccess:function(a){var c=Object.prototype.hasOwnProperty;for(var d in a)c.call(a,d)&&"string"==typeof a[d]&&(a[d]=b.htmlDecode(a[d]));$H(a).each(function(a,b){var c=this.list.list.getElement("#"+b+" ."+this.options.element);"null"!==typeOf(c)&&!1!==a&&c.set("html",a)}.bind(this))}.bind(this)}).send()}})});