/*! Fabrik */

define(["jquery","fab/fabrik"],function(a,b){"use strict";return new Class({initialize:function(b,c){this.form=b,this.options={liveSite:""},this.options=a.extend(this.options,c);var d=this.form.getForm(),e=this.form.id;this.pkfield=d.getElement("input[name=rowid]"),this.view=!0===this.form.options.editable?"form":"details",this.url=this.options.liveSite+"index.php?option=com_fabrik&format=raw&view=plugin&g=form&task=pluginAjax&plugin=paginate&method=xRecord&formid="+e+"&mode="+this.options.view+"&rowid=",this.watchButtons()},doUpdate:function(a){var c,d=JSON.parse(a),e="form"===this.view?d.data:d.html;this.options.ids=d.ids,this.form.formElements.each(function(a,b){if("_ro"!==b.substr(-3)){c=e[b];try{"null"!==typeOf(c)?a.updateUsingRaw()?a.update(d.data[b]):"form"===this.view?a.update(c):a.update(Encoder.htmlDecode(c)):a.update("")}catch(b){console.log(a,c,b)}}}.bind(this)),"form"===this.view&&(this.pkfield.value=e[this.options.pkey]),this.form.options.rowid=d.data[this.options.pkey],this.reScan(),window.fireEvent("fabrik.form.refresh",[d.post.rowid]),b.loader.stop(this.form.getBlock())},reScan:function(){var a,b;"undefined"!=typeof Slimbox&&Slimbox.scanPage(),"undefined"!=typeof Lightbox&&Lightbox.init(),"undefined"!=typeof Mediabox&&Mediabox.scanPage(),a=this.form.getForm(),a.getElements("*[data-paginate]").each(function(a){switch(b=a.get("data-paginate")){case"first":case"prev":0===this.options.ids.index?a.addClass("active"):a.removeClass("active");break;case"next":case"last":this.options.ids.index===this.options.ids.lastKey?a.addClass("active"):a.removeClass("active")}}.bind(this))},doNav:function(a){var c,d=a.get("data-paginate"),e=!0;switch(d){case"first":0===this.options.ids.index&&(e=!1),c=this.options.ids.first;break;case"last":this.options.ids.index===this.options.ids.lastKey&&(e=!1),c=this.options.ids.last;break;case"prev":0===this.options.ids.index&&(e=!1),c=this.options.ids.prev;break;case"next":this.options.ids.index===this.options.ids.lastKey&&(e=!1),c=this.options.ids.next}if(e){b.loader.start(this.form.getBlock());new Request({url:this.url+c,evalScripts:!0,onComplete:function(a){this.doUpdate(a)}.bind(this)}).send()}},watchButtons:function(){this.form.getForm().addEvent("click:relay(*[data-paginate])",function(a,b){a.preventDefault(),this.doNav(b)}.bind(this))}})});